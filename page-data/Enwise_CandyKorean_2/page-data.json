{"componentChunkName":"component---src-templates-post-template-tsx","path":"/Enwise_CandyKorean_2/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"tableOfContents":"<ul>\n<li>\n<p><a href=\"#1-%EB%B2%84%EC%A0%84-%EC%BD%94%EB%93%9C%EB%8A%94-%EC%9D%B4%EB%AF%B8-%EC%82%AC%EC%9A%A9%EB%90%98%EC%97%88%EC%8A%B5%EB%8B%88%EB%8B%A4-%EB%8B%A4%EB%A5%B8-%EB%B2%84%EC%A0%84-%EC%BD%94%EB%93%9C%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EC%84%B8%EC%9A%94\">1. 버전 코드는 이미 사용되었습니다. 다른 버전 코드를 사용해보세요.</a></p>\n<ul>\n<li><a href=\"#%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95\">해결방법</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#2-e_iap_not_available\">2. E_IAP_NOT_AVAILABLE</a></p>\n</li>\n<li>\n<p><a href=\"#3-error-you-need-wrap-your-app-with-withiapcontext-hoc\">3. Error: You need wrap your app with withIAPContext HOC</a></p>\n</li>\n<li>\n<p><a href=\"#4-%EC%9D%B4-%EB%B2%84%EC%A0%84%EC%9D%98-%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%EC%97%90%EC%84%9C%EB%8A%94-google-play%EB%A5%BC-%ED%86%B5%ED%95%9C-%EA%B2%B0%EC%A0%9C%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%A0-%EC%88%98-%EC%97%86%EC%8A%B5%EB%8B%88%EB%8B%A4\">4. 이 버전의 애플리케이션에서는 google play를 통한 결제를 사용할 수 없습니다.</a></p>\n</li>\n<li>\n<p><a href=\"#expo-inapppurchases\">Expo InAppPurchases</a></p>\n<ul>\n<li><a href=\"#finishtransactionasyncpurchase-consumeitem\">finishTransactionAsync(purchase, consumeItem)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#purchaseitemasyncitemid-details-setpurchaselistenercallback\">purchaseItemAsync(itemId, details), setPurchaseListener(callback)</a></p>\n</li>\n</ul>","html":"<p>Enwise 국가근로 활동을 하면서 진행한 프로젝트, CandyKorean 앱의 인앱 결제 기능을 구현하면서 생긴 트러블 슈팅들을 정리해보았다.<br>\n또한, Expo의 InAppPurchases 라이브러리를 어떤식으로 사용하였는지 적어보았다.</p>\n<h1 id=\"1-버전-코드는-이미-사용되었습니다-다른-버전-코드를-사용해보세요\" style=\"position:relative;\">1. 버전 코드는 이미 사용되었습니다. 다른 버전 코드를 사용해보세요.<a href=\"#1-%EB%B2%84%EC%A0%84-%EC%BD%94%EB%93%9C%EB%8A%94-%EC%9D%B4%EB%AF%B8-%EC%82%AC%EC%9A%A9%EB%90%98%EC%97%88%EC%8A%B5%EB%8B%88%EB%8B%A4-%EB%8B%A4%EB%A5%B8-%EB%B2%84%EC%A0%84-%EC%BD%94%EB%93%9C%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EC%84%B8%EC%9A%94\" aria-label=\"1 버전 코드는 이미 사용되었습니다 다른 버전 코드를 사용해보세요 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<blockquote>\n<p>참고링크 : <a href=\"https://goddino.tistory.com/274\" target=\"_blank\" rel=\"nofollow\">https://goddino.tistory.com/274</a></p>\n</blockquote>\n<p>react native 에서 빌드 과정을 거치고, 구글 플레이 콘솔에서 앱 출시를 위해 aab 파일을 업로드 하였더니 다음과 같은 오류가 떴다.<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 627px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/037faa6c42cdf86d0bad689ce7370fe9/5986b/version_code_error.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.45833333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABJ0AAASdAHeZh94AAAAp0lEQVQoz51RXQ+DMAjs//+PLnEPi1rr7BettXiLukW3+KAjuUAIHHCIum5QFDeU5R3MjNmmacK/JsZxxJASUkoL0RXwDGYwbznxO+Ec2Vob4oBHJb96xdlt9lLknOG9hzEWjWzhPYEorCefVWtPnDND9YSnCZB9RKUI2sa3htbCaQ03e2thjdm8cwtCCIcbHw0V2WiErgOpFtQp0CduJSIFxBgvPewFqxInaErVvP4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/037faa6c42cdf86d0bad689ce7370fe9/a59e9/version_code_error.webp 192w,\n/static/037faa6c42cdf86d0bad689ce7370fe9/0ca9f/version_code_error.webp 384w,\n/static/037faa6c42cdf86d0bad689ce7370fe9/faefd/version_code_error.webp 627w\"\n              sizes=\"(max-width: 627px) 100vw, 627px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/037faa6c42cdf86d0bad689ce7370fe9/3b721/version_code_error.png 192w,\n/static/037faa6c42cdf86d0bad689ce7370fe9/66595/version_code_error.png 384w,\n/static/037faa6c42cdf86d0bad689ce7370fe9/5986b/version_code_error.png 627w\"\n            sizes=\"(max-width: 627px) 100vw, 627px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/037faa6c42cdf86d0bad689ce7370fe9/5986b/version_code_error.png\"\n            alt=\"버전 코드 에러\"\n            title=\"버전 코드 에러\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2 id=\"해결방법\" style=\"position:relative;\">해결방법<a href=\"#%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95\" aria-label=\"해결방법 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>react-native를 사용한다면 app.json 파일에서 version, versionCode를 기존의 1에서 다른 것으로 바꿔야 에러가 뜨지 않는다라고 블로그에 적혀있었다. 하지만, <code class=\"language-text\">이미 android 앱으로 빌드를 마친 상태에서는 app.json이 아닌 build.gradle의 android 블럭 내용을 참조</code>한다고 콘솔창에 안내되었다. 그러므로, 아래 코드의 versionCode를 수정하여 에러를 해결하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">android <span class=\"token punctuation\">{</span>\r\n    ndkVersion rootProject.ext.ndkVersion\r\n\r\n    compileSdkVersion rootProject.ext.compileSdkVersion\r\n\r\n    defaultConfig <span class=\"token punctuation\">{</span>\r\n        applicationId 'com.candykorean.candykoreanapp'\r\n        minSdkVersion rootProject.ext.minSdkVersion\r\n        targetSdkVersion rootProject.ext.targetSdkVersion\r\n        versionCode <span class=\"token number\">42</span>\r\n        versionName <span class=\"token string\">\"1.0.3\"</span>\r\n        buildConfigField <span class=\"token string\">\"boolean\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"IS_NEW_ARCHITECTURE_ENABLED\"</span><span class=\"token punctuation\">,</span> isNewArchitectureEnabled().toString()\r\n\r\n\t\t\t\t...</code></pre></div>\n<h1 id=\"2-e_iap_not_available\" style=\"position:relative;\">2. E_IAP_NOT_AVAILABLE<a href=\"#2-e_iap_not_available\" aria-label=\"2 e_iap_not_available permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>처음엔 react-native-iap 라이브러리를 활용하기로 하였지만, 계속해서 제목과 같은 오류가 떴다.<br>\n꼼꼼하게 찾아본 결과, Expo 환경에서는 Expo 만의 In-App Purchase 라이브러리를 사용해야 한다는 것을 알게 되었다.<br>\n만약 react native cli 환경에서 인앱 결제 기능을 구현할 시엔, 다음 글을 참고하면 좋을 것 같다.</p>\n<blockquote>\n<p><a href=\"https://github.com/dooboolab-community/react-native-iap/issues/1404\" target=\"_blank\" rel=\"nofollow\">https://github.com/dooboolab-community/react-native-iap/issues/1404</a></p>\n</blockquote>\n<h1 id=\"3-error-you-need-wrap-your-app-with-withiapcontext-hoc\" style=\"position:relative;\">3. Error: You need wrap your app with withIAPContext HOC<a href=\"#3-error-you-need-wrap-your-app-with-withiapcontext-hoc\" aria-label=\"3 error you need wrap your app with withiapcontext hoc permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<blockquote>\n<p><a href=\"https://velog.io/@lumpenop/TIL-RN-%EC%9D%B8%EC%95%B1-%EA%B2%B0%EC%A0%9C-react-native-iap-6-Hooks-221130\" target=\"_blank\" rel=\"nofollow\">https://velog.io/@lumpenop/TIL-RN-%EC%9D%B8%EC%95%B1-%EA%B2%B0%EC%A0%9C-react-native-iap-6-Hooks-221130</a></p>\n</blockquote>\n<p>사실 이 에러 또한 2번 에러때와 마찬가지로 react-native-iap 라이브러리를 사용하려고 해서 뜬 에러이다.<br>\nuseIAP() 훅은 간단한 react-native-iap 메서드에 쉽게 엑세스할 수 있는 방법이다. 다음과 같이 사용하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>View<span class=\"token punctuation\">,</span> Text<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-native'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>requestPurchase<span class=\"token punctuation\">,</span> useIAP<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-native-iap'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\r\n    connected<span class=\"token punctuation\">,</span>\r\n    products<span class=\"token punctuation\">,</span>\r\n    promotedProductsIOS<span class=\"token punctuation\">,</span>\r\n    subscriptions<span class=\"token punctuation\">,</span>\r\n    purchaseHistories<span class=\"token punctuation\">,</span>\r\n    availablePurchases<span class=\"token punctuation\">,</span>\r\n    currentPurchase<span class=\"token punctuation\">,</span>\r\n    currentPurchaseError<span class=\"token punctuation\">,</span>\r\n    initConnectionError<span class=\"token punctuation\">,</span>\r\n    finishTransaction<span class=\"token punctuation\">,</span>\r\n    getProducts<span class=\"token punctuation\">,</span>\r\n    getSubscriptions<span class=\"token punctuation\">,</span>\r\n    getAvailablePurchases<span class=\"token punctuation\">,</span>\r\n    getPurchaseHistories<span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useIAP</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n\t<span class=\"token operator\">...</span></code></pre></div>\n<h1 id=\"4-이-버전의-애플리케이션에서는-google-play를-통한-결제를-사용할-수-없습니다\" style=\"position:relative;\">4. 이 버전의 애플리케이션에서는 google play를 통한 결제를 사용할 수 없습니다.<a href=\"#4-%EC%9D%B4-%EB%B2%84%EC%A0%84%EC%9D%98-%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%EC%97%90%EC%84%9C%EB%8A%94-google-play%EB%A5%BC-%ED%86%B5%ED%95%9C-%EA%B2%B0%EC%A0%9C%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%A0-%EC%88%98-%EC%97%86%EC%8A%B5%EB%8B%88%EB%8B%A4\" aria-label=\"4 이 버전의 애플리케이션에서는 google play를 통한 결제를 사용할 수 없습니다 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<blockquote>\n<p><a href=\"https://itstudy-mary.tistory.com/401?category=929375\" target=\"_blank\" rel=\"nofollow\">https://itstudy-mary.tistory.com/401?category=929375</a></p>\n</blockquote>\n<p>인앱 결제 기능을 테스트 하던 도중, 제목과 같은 에러를 발견하였다.<br>\n해당 빌드 버전과 콘솔에 등록된 버전이 달라서 발생한 에러였다. 콘솔 내의 버전 등록이 완료되려면 시간이 좀 걸리므로, 1, 2시간 정도 기다리니 오류가 해결되었다.</p>\n<h1 id=\"expo-inapppurchases\" style=\"position:relative;\">Expo InAppPurchases<a href=\"#expo-inapppurchases\" aria-label=\"expo inapppurchases permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<blockquote>\n<p><a href=\"https://docs.expo.dev/versions/latest/sdk/in-app-purchases/\" target=\"_blank\" rel=\"nofollow\">https://docs.expo.dev/versions/latest/sdk/in-app-purchases/</a></p>\n</blockquote>\n<h2 id=\"finishtransactionasyncpurchase-consumeitem\" style=\"position:relative;\">finishTransactionAsync(purchase, consumeItem)<a href=\"#finishtransactionasyncpurchase-consumeitem\" aria-label=\"finishtransactionasyncpurchase consumeitem permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>cosumeItem이 false이면, 딱 한번만 구매할 수 있는 상품임을 의미하고, true면 한 번 이상 사용할 수 있다는 의미이다. 이번 프로젝트 같은 경우엔 강의를 한 번 구매하면 계속해서 사용할 수 있으므로 false로 설정하였다.</p>\n<h1 id=\"purchaseitemasyncitemid-details-setpurchaselistenercallback\" style=\"position:relative;\">purchaseItemAsync(itemId, details), setPurchaseListener(callback)<a href=\"#purchaseitemasyncitemid-details-setpurchaselistenercallback\" aria-label=\"purchaseitemasyncitemid details setpurchaselistenercallback permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>인앱 결제 기능의 핵심이라고 할 수 있는 함수들이다. 구매를 시도하고, 그 구매의 결과에 대한 처리를 해주는 콜백함수를 정의해줘야 결제 프로세스가 완료가 된다. 프로젝트에서는 다음과 같이 구현을 하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handlePayment</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">courseName</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token comment\">// 결제 프로세스 여기에 필요!</span>\r\n\r\n  <span class=\"token comment\">// 인앱결제 test용 courseName -> 나중에 지우기</span>\r\n  <span class=\"token comment\">// courseName = \"iap_test\"</span>\r\n  <span class=\"token comment\">// setBottomText(courseName);</span>\r\n\r\n  <span class=\"token keyword\">let</span> itemArray <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>courseName <span class=\"token operator\">===</span> <span class=\"token string\">'Conversational Korean Course'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    itemArray<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">'lollipop_yoojin'</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token comment\">// itemArray.push(\"iap_test_3\");</span>\r\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>courseName <span class=\"token operator\">===</span> <span class=\"token string\">'Survival Korean Course'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    itemArray<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">'lollipop_seongyeop'</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>courseName <span class=\"token operator\">===</span> <span class=\"token string\">'After Like Course'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    itemArray<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">'lollipop_kyungeun'</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">// 구매 정보 가져오기</span>\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> responseCode<span class=\"token punctuation\">,</span> results <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getProductsAsync</span><span class=\"token punctuation\">(</span>itemArray<span class=\"token punctuation\">)</span>\r\n\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>responseCode <span class=\"token operator\">===</span> IAPResponseCode<span class=\"token punctuation\">.</span><span class=\"token constant\">OK</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">setProductId</span><span class=\"token punctuation\">(</span>results<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>productId<span class=\"token punctuation\">)</span>\r\n      <span class=\"token function\">setBottomText</span><span class=\"token punctuation\">(</span>results<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>productId<span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">setBottomText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'something wrong!'</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token comment\">// 구매 내역에 없는 상품일때만 결제 진행</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>purchasedCourseList<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>itemInfo<span class=\"token punctuation\">.</span>course_id<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">purchaseItemAsync</span><span class=\"token punctuation\">(</span>results<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>productId<span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token comment\">// 아닐떈, 바로 이미 구입한 상품이라고 알려주기</span>\r\n      navigation<span class=\"token punctuation\">.</span><span class=\"token function\">navigate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'PaymentResult'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">user_id</span><span class=\"token operator\">:</span> userId<span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">itemInfo</span><span class=\"token operator\">:</span> itemInfo<span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">isSuccess</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\r\n        returnToClass<span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">imgUrl</span><span class=\"token operator\">:</span> imgUrl<span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">isBought</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">setPurchaseListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token parameter\">result</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>responseCode <span class=\"token operator\">===</span> IAPResponseCode<span class=\"token punctuation\">.</span><span class=\"token constant\">OK</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n          <span class=\"token function\">setBottomText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'success'</span><span class=\"token punctuation\">)</span>\r\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>result<span class=\"token punctuation\">.</span>results<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>acknowledged<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token function\">setBottomText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'successful purchase'</span><span class=\"token punctuation\">)</span>\r\n            <span class=\"token keyword\">await</span> <span class=\"token function\">finishTransactionAsync</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>results<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\r\n\r\n            <span class=\"token comment\">// 계속 구매 가능한지 test</span>\r\n            <span class=\"token comment\">// await finishTransactionAsync(result.results[0], true);</span>\r\n\r\n            <span class=\"token comment\">// DB에 저장 - purchasedCourse 에 없는 경우에만!</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>purchasedCourseList<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>itemInfo<span class=\"token punctuation\">.</span>course_id<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n              <span class=\"token function\">createPurchasedCourse</span><span class=\"token punctuation\">(</span>\r\n                <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">user_id</span><span class=\"token operator\">:</span> userId<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">course_id</span><span class=\"token operator\">:</span> itemInfo<span class=\"token punctuation\">.</span>course_id <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n                <span class=\"token parameter\">d</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n                  navigation<span class=\"token punctuation\">.</span><span class=\"token function\">navigate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'PaymentResult'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n                    <span class=\"token literal-property property\">user_id</span><span class=\"token operator\">:</span> userId<span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">itemInfo</span><span class=\"token operator\">:</span> itemInfo<span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">isSuccess</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\r\n                    returnToClass<span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">imgUrl</span><span class=\"token operator\">:</span> imgUrl<span class=\"token punctuation\">,</span>\r\n                  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n                setIsCoursePurchased<span class=\"token punctuation\">,</span>\r\n                <span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n                  <span class=\"token function\">setIsSuccess</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\r\n                  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span>\r\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token punctuation\">)</span>\r\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n              navigation<span class=\"token punctuation\">.</span><span class=\"token function\">navigate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'PaymentResult'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token literal-property property\">user_id</span><span class=\"token operator\">:</span> userId<span class=\"token punctuation\">,</span>\r\n                <span class=\"token literal-property property\">itemInfo</span><span class=\"token operator\">:</span> itemInfo<span class=\"token punctuation\">,</span>\r\n                <span class=\"token literal-property property\">isSuccess</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\r\n                returnToClass<span class=\"token punctuation\">,</span>\r\n                <span class=\"token literal-property property\">imgUrl</span><span class=\"token operator\">:</span> imgUrl<span class=\"token punctuation\">,</span>\r\n              <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n            <span class=\"token punctuation\">}</span>\r\n          <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\r\n          result<span class=\"token punctuation\">.</span>responseCode <span class=\"token operator\">===</span> IAPResponseCode<span class=\"token punctuation\">.</span><span class=\"token constant\">USER_CANCELED</span> <span class=\"token operator\">||</span>\r\n          result<span class=\"token punctuation\">.</span>responseCode <span class=\"token operator\">===</span> IAPResponseCode<span class=\"token punctuation\">.</span><span class=\"token constant\">DEFERRED</span>\r\n        <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n          <span class=\"token function\">setBottomText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'User canceled the transaction'</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n          <span class=\"token function\">setBottomText</span><span class=\"token punctuation\">(</span>\r\n            <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Something went wrong with the purchase. Received errorCode </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>result<span class=\"token punctuation\">.</span>errorCode<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token punctuation\">)</span>\r\n          navigation<span class=\"token punctuation\">.</span><span class=\"token function\">navigate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'PaymentResult'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token literal-property property\">user_id</span><span class=\"token operator\">:</span> userId<span class=\"token punctuation\">,</span>\r\n            <span class=\"token literal-property property\">itemInfo</span><span class=\"token operator\">:</span> itemInfo<span class=\"token punctuation\">,</span>\r\n            <span class=\"token literal-property property\">isSuccess</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\r\n            returnToClass<span class=\"token punctuation\">,</span>\r\n            <span class=\"token literal-property property\">imgUrl</span><span class=\"token operator\">:</span> imgUrl<span class=\"token punctuation\">,</span>\r\n            <span class=\"token literal-property property\">isBought</span><span class=\"token operator\">:</span> result<span class=\"token punctuation\">.</span>errorCode <span class=\"token operator\">===</span> <span class=\"token number\">8</span> <span class=\"token operator\">?</span> <span class=\"token boolean\">true</span> <span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">}</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">disconnectAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token function\">setBottomText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error!!!!!'</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  navigation<span class=\"token punctuation\">.</span><span class=\"token function\">navigate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'PaymentResult'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">user_id</span><span class=\"token operator\">:</span> userId<span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">itemInfo</span><span class=\"token operator\">:</span> itemInfo<span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">isSuccess</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\r\n    returnToClass<span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">imgUrl</span><span class=\"token operator\">:</span> imgUrl<span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"title":"Enwise - CandyKorean #2","summary":"Enwise 국가근로 활동에서 진행한 CandyKorean 프로젝트 트러블 슈팅 정리 + 인앱 결제 구현","date":"2023.05.25.","categories":["Enwise","React Native"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAcIAQP/xAAXAQADAQAAAAAAAAAAAAAAAAAFBggJ/9oADAMBAAIQAxAAAAHvQM9MOos41AaHkv8A/8QAGhAAAgMBAQAAAAAAAAAAAAAAAgQBAwUABv/aAAgBAQABBQLLCmx/0CmTGZ2dEE64Z2qd/8QAHREAAgEEAwAAAAAAAAAAAAAAAQIDBAUREgAhMv/aAAgBAwEBPwGw1MUNlucT0kEzVAmjR5BkqRAvbH1rhtcIVIDFlKONm5//xAAfEQACAQMFAQAAAAAAAAAAAAABAgMEETEABRIhQSL/2gAIAQIBAT8B3GJ5K+jdZpIxFwZlU5Bk88v1f6BwAQymw1//xAAmEAADAAEDAwIHAAAAAAAAAAABAgMEERIhACIxBRMQFCNBUXGR/9oACAEBAAY/AsZbnt9xCiEhUtYOvtQpQpQSSzdjUabhR5HO5WZLL3KlUstYtS6jIzElm7UV29RetEx8V8tPklVbUximuCz06gGAI1Pn8gag/sHkHyDyOeswUZnG6le4k/USQ2Nz911On9+H/8QAGxABAQACAwEAAAAAAAAAAAAAAREAECExQVH/2gAIAQEAAT8hFJTCEJlqsSEZIMfGouIXVXnTXqJoBKAXowOCEAOMDTj7rp7h+L651//aAAwDAQACAAMAAAAQzw//xAAWEQEBAQAAAAAAAAAAAAAAAAABERD/2gAIAQMBAT8QRQ6VOIEpBjh4f//EABYRAQEBAAAAAAAAAAAAAAAAAAEREP/aAAgBAgEBPxBQJGQMgBGS7AuGD//EABoQAQEAAwEBAAAAAAAAAAAAAAERACExEEH/2gAIAQEAAT8Q3/JuQwLtO27Krf8AOArQWM05hYUjClsZsv2OrC9hzJiS/UZzqDVPA2+Z9HjwINOB5f/Z"},"images":{"fallback":{"src":"/static/f9995f03e5571864ca41e8994c83107d/7d5eb/thumbnail-react-native.jpg","srcSet":"/static/f9995f03e5571864ca41e8994c83107d/76044/thumbnail-react-native.jpg 256w,\n/static/f9995f03e5571864ca41e8994c83107d/5f05a/thumbnail-react-native.jpg 512w,\n/static/f9995f03e5571864ca41e8994c83107d/7d5eb/thumbnail-react-native.jpg 1024w","sizes":"(min-width: 1024px) 1024px, 100vw"},"sources":[{"srcSet":"/static/f9995f03e5571864ca41e8994c83107d/c5bac/thumbnail-react-native.webp 256w,\n/static/f9995f03e5571864ca41e8994c83107d/ebbe9/thumbnail-react-native.webp 512w,\n/static/f9995f03e5571864ca41e8994c83107d/c025a/thumbnail-react-native.webp 1024w","type":"image/webp","sizes":"(min-width: 1024px) 1024px, 100vw"}]},"width":1024,"height":538}},"publicURL":"/static/f9995f03e5571864ca41e8994c83107d/thumbnail-react-native.jpeg"}}}}]}},"pageContext":{"slug":"/Enwise_CandyKorean_2/"}},"staticQueryHashes":[]}
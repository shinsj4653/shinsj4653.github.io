{"componentChunkName":"component---src-templates-post-template-tsx","path":"/CDC_with_ES/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"tableOfContents":"<ul>\n<li>\n<p><a href=\"#cdc---change-data-capture\">CDC - Change Data Capture</a></p>\n<ul>\n<li><a href=\"#cdc%EC%9D%98-%EB%AA%A9%ED%91%9C\">CDC의 목표</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#log-based-cdc-vs-query-based-cdc\">log-based CDC vs query-based CDC</a></p>\n</li>\n<li>\n<p><a href=\"#docker-compose-file\">docker compose file</a></p>\n<ul>\n<li><a href=\"#execute\">execute</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#postgresql--logstash\">PostgreSQL &#x26; Logstash</a></p>\n<ul>\n<li><a href=\"#trouble-shooting-1---exception-logstash-pluginloadingerror\">Trouble Shooting #1 - Exception: LogStash: PluginLoadingError</a></li>\n<li><a href=\"#logstashconf-input-%EC%84%A4%EC%A0%95\">logstash.conf input 설정</a></li>\n<li><a href=\"#%EC%B6%94%EA%B0%80%EC%A0%81%EC%9D%B8-%EC%84%A4%EC%A0%95\">추가적인 설정</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%B0%B8%EA%B3%A0%EB%A7%81%ED%81%AC\">참고링크</a></p>\n</li>\n</ul>","html":"<p>원래는 Airflow 실습 이후, Kafka와 Debezium의 <code class=\"language-text\">log-based CDC</code> 환경 구축을 하려고 했지만, 상대적으로 접근 난이도가 낮은 ELK를 활용한 <code class=\"language-text\">query-based CDC</code>를 다뤄보면서 CDC에 대한 이해와 실습을 진행해보고자 하였다. 우선 큰 방향성 위주로 글을 작성해봤다. 실습을 진행하면서 글을 업데이트 할 예정이다.</p>\n<h1 id=\"cdc---change-data-capture\" style=\"position:relative;\">CDC - Change Data Capture<a href=\"#cdc---change-data-capture\" aria-label=\"cdc   change data capture permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>DBMS의 clustering, sharding 등의 고가용성 목표의 이중화에도 활용되거나 DB data pipe-line 구축을 할 때도 사용된다. 핵심은 <code class=\"language-text\">DB 데이터의 변경을 감지해서 Event 기반 또는 다양한 형태로 그 내용을 가져온다는 것</code>이다.</p>\n<h2 id=\"cdc의-목표\" style=\"position:relative;\">CDC의 목표<a href=\"#cdc%EC%9D%98-%EB%AA%A9%ED%91%9C\" aria-label=\"cdc의 목표 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ol>\n<li>엔터프라이즈 DBMS 스트레스 및 부하 분산</li>\n<li>장기 보관 데이터 - 한 번 create되면 update될 일이 거의 없는 data위주 ex) 접속 로그, 매출 데이터, 출생 신고 이력 등의 이관</li>\n<li>다양한 text searching optimization 구현</li>\n</ol>\n<h1 id=\"log-based-cdc-vs-query-based-cdc\" style=\"position:relative;\">log-based CDC vs query-based CDC<a href=\"#log-based-cdc-vs-query-based-cdc\" aria-label=\"log based cdc vs query based cdc permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<ul>\n<li><code class=\"language-text\">log-based CDC</code> : DBMS에서 기본적으로 생성하는 <code class=\"language-text\">transaction log</code>를 기반으로 하며, psql의 경우 wal file, mysql binary log 등을 활용해 CDC 환경을 구성하는 것이다.</li>\n<li><code class=\"language-text\">query-based CDC</code> : CDC origin(target) DBMS 대상으로 big-query 또는 특정 주기로 schedule된 query를 바탕으로 CDC 환경을 구성하는 것이다.</li>\n</ul>\n<h1 id=\"docker-compose-file\" style=\"position:relative;\">docker compose file<a href=\"#docker-compose-file\" aria-label=\"docker compose file permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<ul>\n<li>elastic cluster를 3개의 노드로 구성하고 있는 형태이다. 공식 홈페이지의 ELK Stack docker compose를 base로 한다.</li>\n<li><a href=\"https://www.elastic.co/kr/blog/getting-started-with-the-elastic-stack-and-docker-compose\" target=\"_blank\" rel=\"nofollow\">Getting started with the Elastic Stack and Docker-Compose</a></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">version: <span class=\"token string\">'3'</span>\nservices:\n\n  setup:\n    image: docker.elastic.co/elasticsearch/elasticsearch:<span class=\"token variable\">${STACK_VERSION}</span>\n    volumes:\n      - ./certs:/usr/share/elasticsearch/config/certs\n    user: <span class=\"token string\">\"0\"</span>\n    command: <span class=\"token operator\">></span>\n      <span class=\"token function\">bash</span> -c <span class=\"token string\">'\n        if [ x${ELASTIC_PASSWORD} == x ]; then\n          echo \"Set the ELASTIC_PASSWORD environment variable in the .env file\";\n          exit 1;\n        elif [ x${KIBANA_PASSWORD} == x ]; then\n          echo \"Set the KIBANA_PASSWORD environment variable in the .env file\";\n          exit 1;\n        fi;\n        if [ ! -f config/certs/ca.zip ]; then\n          echo \"Creating CA\";\n          bin/elasticsearch-certutil ca --silent --pem -out config/certs/ca.zip;\n          unzip config/certs/ca.zip -d config/certs;\n        fi;\n        if [ ! -f config/certs/certs.zip ]; then\n          echo \"Creating certs\";\n          echo -ne \\\n          \"instances:\\n\"\\\n          \"  - name: es01\\n\"\\\n          \"    dns:\\n\"\\\n          \"      - es01\\n\"\\\n          \"      - localhost\\n\"\\\n          \"    ip:\\n\"\\\n          \"      - 127.0.0.1\\n\"\\\n          \"  - name: es02\\n\"\\\n          \"    dns:\\n\"\\\n          \"      - es02\\n\"\\\n          \"      - localhost\\n\"\\\n          \"    ip:\\n\"\\\n          \"      - 127.0.0.1\\n\"\\\n          \"  - name: es03\\n\"\\\n          \"    dns:\\n\"\\\n          \"      - es03\\n\"\\\n          \"      - localhost\\n\"\\\n          \"    ip:\\n\"\\\n          \"      - 127.0.0.1\\n\"\\\n          > config/certs/instances.yml;\n          bin/elasticsearch-certutil cert --silent --pem -out config/certs/certs.zip --in config/certs/instances.yml --ca-cert config/certs/ca/ca.crt --ca-key config/certs/ca/ca.key;\n          unzip config/certs/certs.zip -d config/certs;\n        fi;\n        echo \"Setting file permissions\"\n        chown -R root:root config/certs;\n        find . -type d -exec chmod 750 \\{\\} \\;;\n        find . -type f -exec chmod 640 \\{\\} \\;;\n        echo \"Waiting for Elasticsearch availability\";\n        until curl -s --cacert config/certs/ca/ca.crt https://es01:9200 | grep -q \"missing authentication credentials\"; do sleep 30; done;\n        echo \"Setting kibana_system password\";\n        until curl -s -X POST --cacert config/certs/ca/ca.crt -u \"elastic:${ELASTIC_PASSWORD}\" -H \"Content-Type: application/json\" https://es01:9200/_security/user/kibana_system/_password -d \"{\\\"password\\\":\\\"${KIBANA_PASSWORD}\\\"}\" | grep -q \"^{}\"; do sleep 10; done;\n        echo \"All done!\";\n      '</span>\n    healthcheck:\n      test: <span class=\"token punctuation\">[</span><span class=\"token string\">\"CMD-SHELL\"</span>, <span class=\"token string\">\"[ -f config/certs/es01/es01.crt ]\"</span><span class=\"token punctuation\">]</span>\n      interval: 1s\n      timeout: 5s\n      retries: <span class=\"token number\">120</span>\n    networks:\n      - esnet\n\n  es01:\n    depends_on:\n      setup:\n        condition: service_healthy\n    image: docker.elastic.co/elasticsearch/elasticsearch:<span class=\"token variable\">${STACK_VERSION}</span>\n    container_name: es01\n    hostname: es01\n    volumes:\n      - ./certs:/usr/share/elasticsearch/config/certs\n      - ./esdata01:/usr/share/elasticsearch/data\n    ports:\n      - <span class=\"token variable\">${ES_PORT}</span>:9200\n    environment:\n      - <span class=\"token assign-left variable\">ELASTIC_PASSWORD</span><span class=\"token operator\">=</span><span class=\"token variable\">${ELASTIC_PASSWORD}</span>\n      - node.name<span class=\"token operator\">=</span>es01\n      - cluster.name<span class=\"token operator\">=</span><span class=\"token variable\">${CLUSTER_NAME}</span>\n      - cluster.initial_master_nodes<span class=\"token operator\">=</span>es01,es02,es03\n      - discovery.seed_hosts<span class=\"token operator\">=</span>es02,es03\n      - bootstrap.memory_lock<span class=\"token operator\">=</span>true\n      - xpack.security.enabled<span class=\"token operator\">=</span>true\n      - xpack.security.http.ssl.enabled<span class=\"token operator\">=</span>true\n      - xpack.security.http.ssl.key<span class=\"token operator\">=</span>certs/es01/es01.key\n      - xpack.security.http.ssl.certificate<span class=\"token operator\">=</span>certs/es01/es01.crt\n      - xpack.security.http.ssl.certificate_authorities<span class=\"token operator\">=</span>certs/ca/ca.crt\n      - xpack.security.http.ssl.verification_mode<span class=\"token operator\">=</span>certificate\n      - xpack.security.transport.ssl.enabled<span class=\"token operator\">=</span>true\n      - xpack.security.transport.ssl.key<span class=\"token operator\">=</span>certs/es01/es01.key\n      - xpack.security.transport.ssl.certificate<span class=\"token operator\">=</span>certs/es01/es01.crt\n      - xpack.security.transport.ssl.certificate_authorities<span class=\"token operator\">=</span>certs/ca/ca.crt\n      - xpack.security.transport.ssl.verification_mode<span class=\"token operator\">=</span>certificate\n      - xpack.license.self_generated.type<span class=\"token operator\">=</span><span class=\"token variable\">${LICENSE}</span>\n    mem_limit: <span class=\"token variable\">${MEM_LIMIT}</span>\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    healthcheck:\n      test:\n        <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">\"CMD-SHELL\"</span>,\n          <span class=\"token string\">\"curl -s --cacert config/certs/ca/ca.crt https://localhost:9200 | grep -q 'missing authentication credentials'\"</span>,\n        <span class=\"token punctuation\">]</span>\n      interval: 10s\n      timeout: 10s\n      retries: <span class=\"token number\">120</span>\n    networks:\n      - esnet\n\n  es02:\n    depends_on:\n      - es01\n    image: docker.elastic.co/elasticsearch/elasticsearch:<span class=\"token variable\">${STACK_VERSION}</span>\n    container_name: es02\n    hostname: es02\n    volumes:\n      - ./certs:/usr/share/elasticsearch/config/certs\n      - ./esdata02:/usr/share/elasticsearch/data\n    environment:\n      - node.name<span class=\"token operator\">=</span>es02\n      - cluster.name<span class=\"token operator\">=</span><span class=\"token variable\">${CLUSTER_NAME}</span>\n      - cluster.initial_master_nodes<span class=\"token operator\">=</span>es01,es02,es03\n      - discovery.seed_hosts<span class=\"token operator\">=</span>es01,es03\n      - bootstrap.memory_lock<span class=\"token operator\">=</span>true\n      - xpack.security.enabled<span class=\"token operator\">=</span>true\n      - xpack.security.http.ssl.enabled<span class=\"token operator\">=</span>true\n      - xpack.security.http.ssl.key<span class=\"token operator\">=</span>certs/es02/es02.key\n      - xpack.security.http.ssl.certificate<span class=\"token operator\">=</span>certs/es02/es02.crt\n      - xpack.security.http.ssl.certificate_authorities<span class=\"token operator\">=</span>certs/ca/ca.crt\n      - xpack.security.http.ssl.verification_mode<span class=\"token operator\">=</span>certificate\n      - xpack.security.transport.ssl.enabled<span class=\"token operator\">=</span>true\n      - xpack.security.transport.ssl.key<span class=\"token operator\">=</span>certs/es02/es02.key\n      - xpack.security.transport.ssl.certificate<span class=\"token operator\">=</span>certs/es02/es02.crt\n      - xpack.security.transport.ssl.certificate_authorities<span class=\"token operator\">=</span>certs/ca/ca.crt\n      - xpack.security.transport.ssl.verification_mode<span class=\"token operator\">=</span>certificate\n      - xpack.license.self_generated.type<span class=\"token operator\">=</span><span class=\"token variable\">${LICENSE}</span>\n    mem_limit: <span class=\"token variable\">${MEM_LIMIT}</span>\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    healthcheck:\n      test:\n        <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">\"CMD-SHELL\"</span>,\n          <span class=\"token string\">\"curl -s --cacert config/certs/ca/ca.crt https://localhost:9200 | grep -q 'missing authentication credentials'\"</span>,\n        <span class=\"token punctuation\">]</span>\n      interval: 10s\n      timeout: 10s\n      retries: <span class=\"token number\">120</span>\n    networks:\n      - esnet\n\n  es03:\n    depends_on:\n      - es02\n    image: docker.elastic.co/elasticsearch/elasticsearch:<span class=\"token variable\">${STACK_VERSION}</span>\n    container_name: es03\n    hostname: es03\n    volumes:\n      - ./certs:/usr/share/elasticsearch/config/certs\n      - ./esdata03:/usr/share/elasticsearch/data\n    environment:\n      - node.name<span class=\"token operator\">=</span>es03\n      - cluster.name<span class=\"token operator\">=</span><span class=\"token variable\">${CLUSTER_NAME}</span>\n      - cluster.initial_master_nodes<span class=\"token operator\">=</span>es01,es02,es03\n      - discovery.seed_hosts<span class=\"token operator\">=</span>es01,es02\n      - bootstrap.memory_lock<span class=\"token operator\">=</span>true\n      - xpack.security.enabled<span class=\"token operator\">=</span>true\n      - xpack.security.http.ssl.enabled<span class=\"token operator\">=</span>true\n      - xpack.security.http.ssl.key<span class=\"token operator\">=</span>certs/es03/es03.key\n      - xpack.security.http.ssl.certificate<span class=\"token operator\">=</span>certs/es03/es03.crt\n      - xpack.security.http.ssl.certificate_authorities<span class=\"token operator\">=</span>certs/ca/ca.crt\n      - xpack.security.http.ssl.verification_mode<span class=\"token operator\">=</span>certificate\n      - xpack.security.transport.ssl.enabled<span class=\"token operator\">=</span>true\n      - xpack.security.transport.ssl.key<span class=\"token operator\">=</span>certs/es03/es03.key\n      - xpack.security.transport.ssl.certificate<span class=\"token operator\">=</span>certs/es03/es03.crt\n      - xpack.security.transport.ssl.certificate_authorities<span class=\"token operator\">=</span>certs/ca/ca.crt\n      - xpack.security.transport.ssl.verification_mode<span class=\"token operator\">=</span>certificate\n      - xpack.license.self_generated.type<span class=\"token operator\">=</span><span class=\"token variable\">${LICENSE}</span>\n    mem_limit: <span class=\"token variable\">${MEM_LIMIT}</span>\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    healthcheck:\n      test:\n        <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">\"CMD-SHELL\"</span>,\n          <span class=\"token string\">\"curl -s --cacert config/certs/ca/ca.crt https://localhost:9200 | grep -q 'missing authentication credentials'\"</span>,\n        <span class=\"token punctuation\">]</span>\n      interval: 10s\n      timeout: 10s\n      retries: <span class=\"token number\">120</span>\n    networks:\n      - esnet\n\n  kibana:\n    depends_on:\n      es01:\n        condition: service_healthy\n      es02:\n        condition: service_healthy\n      es03:\n        condition: service_healthy\n    image: docker.elastic.co/kibana/kibana:<span class=\"token variable\">${STACK_VERSION}</span>\n    container_name: kibana\n    hostname: kibana\n    volumes:\n      - ./certs:/usr/share/kibana/config/certs\n      - ./kibanadata:/usr/share/kibana/data\n    ports:\n      - <span class=\"token variable\">${KIBANA_PORT}</span>:5601\n    environment:\n      - <span class=\"token assign-left variable\">SERVERNAME</span><span class=\"token operator\">=</span>kibana\n      - <span class=\"token assign-left variable\">ELASTICSEARCH_HOSTS</span><span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"https://es01:9200\"</span>,<span class=\"token string\">\"https://es02:9200\"</span>,<span class=\"token string\">\"https://es03:9200\"</span><span class=\"token punctuation\">]</span>\n      - <span class=\"token assign-left variable\">ELASTICSEARCH_USERNAME</span><span class=\"token operator\">=</span>kibana_system\n      - <span class=\"token assign-left variable\">ELASTICSEARCH_PASSWORD</span><span class=\"token operator\">=</span><span class=\"token variable\">${KIBANA_PASSWORD}</span>\n      - <span class=\"token assign-left variable\">ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES</span><span class=\"token operator\">=</span>config/certs/ca/ca.crt\n    mem_limit: <span class=\"token variable\">${MEM_LIMIT}</span>\n    healthcheck:\n      test:\n        <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">\"CMD-SHELL\"</span>,\n          <span class=\"token string\">\"curl -s -I http://localhost:5601 | grep -q 'HTTP/1.1 302 Found'\"</span>,\n        <span class=\"token punctuation\">]</span>\n      interval: 10s\n      timeout: 10s\n      retries: <span class=\"token number\">120</span>\n    networks:\n      - esnet\n\nnetworks:\n  esnet:</code></pre></div>\n<ul>\n<li>필수 설정해야할 환경 변수는 아래와 같다. <code class=\"language-text\">docker-compose.yml</code>과 같은 경로에 <code class=\"language-text\">.env</code> 로 만들어서 세팅하자.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Password for the 'elastic' user (at least 6 characters)</span>\n<span class=\"token assign-left variable\">ELASTIC_PASSWORD</span><span class=\"token operator\">=</span>admin123<span class=\"token operator\">!</span>\n\n<span class=\"token comment\"># Password for the 'kibana_system' user (at least 6 characters)</span>\n<span class=\"token assign-left variable\">KIBANA_PASSWORD</span><span class=\"token operator\">=</span>admin123<span class=\"token operator\">!</span>\n\n<span class=\"token comment\"># Version of Elastic products</span>\n<span class=\"token assign-left variable\">STACK_VERSION</span><span class=\"token operator\">=</span><span class=\"token number\">8.7</span>.0\n\n<span class=\"token comment\"># Set the cluster name</span>\n<span class=\"token assign-left variable\">CLUSTER_NAME</span><span class=\"token operator\">=</span>elk-cdc-cluster\n\n<span class=\"token comment\"># Set to 'basic' or 'trial' to automatically start the 30-day trial</span>\n<span class=\"token assign-left variable\">LICENSE</span><span class=\"token operator\">=</span>basic\n<span class=\"token comment\">#LICENSE=trial</span>\n\n<span class=\"token comment\"># Port to expose Elasticsearch HTTP API to the host</span>\n<span class=\"token assign-left variable\">ES_PORT</span><span class=\"token operator\">=</span><span class=\"token number\">9200</span>\n\n<span class=\"token comment\"># Port to expose Kibana to the host</span>\n<span class=\"token assign-left variable\">KIBANA_PORT</span><span class=\"token operator\">=</span><span class=\"token number\">5601</span>\n\n<span class=\"token comment\"># Increase or decrease based on the available host memory (in bytes)</span>\n<span class=\"token assign-left variable\">MEM_LIMIT</span><span class=\"token operator\">=</span><span class=\"token number\">1073741824</span>\n\n<span class=\"token comment\"># Project namespace (defaults to the current folder name if not set)</span>\n<span class=\"token assign-left variable\">COMPOSE_PROJECT_NAME</span><span class=\"token operator\">=</span>elk-cdc-app</code></pre></div>\n<ul>\n<li>\n<p>8.x version 부터는 보안 인증 세팅이 기본으로 되어있다. 그래서 https를 위한 ssl 인증서가 필요하다. <code class=\"language-text\">setup</code> service가 이를 위해 존재하며, 해당 세팅을 한 뒤에 kill 된다. 실행하고 나면 <code class=\"language-text\">certs</code> 디렉토리가 만들어질텐데 해당 파일이 ssl 인증서이다.</p>\n</li>\n<li>\n<p>compose 실행 시, project name을 <code class=\"language-text\">elk-cdc-app</code>로 준다.</p>\n</li>\n</ul>\n<h2 id=\"execute\" style=\"position:relative;\">execute<a href=\"#execute\" aria-label=\"execute permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> compose -f ./docker-compose.yml -p elk-cdc-app up -d</code></pre></div>\n<p>해당 명령어로 실행 시, setup이 돌고 ssl를 갱신&#x26;생신 이후 es node 가 활성화 되며 뒤이어 kibana가 활성화 된다.<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5e027d675a2616f4b4caa47be494817f/85779/image-23.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.9375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABVklEQVQoz0WR63KDIBCF8xo1XhLxilwEFQVN0nY60x99/+c5HTaZ9gfDsrBnv7OcCm7A1IqiH5E1ElmrwJQD0x79FNCZDY12KMWECzfIO00rxuda0Iq18Zw2Cqe8N2ilBZMLkjYmJSo1I60FxXwOyDqNWjv01lNxpRao9U75pBrQGA/uHij1hlPBLUouwKYDzD6I8tyOSHuLnE/gU6DuTM60vzFOtMO8o3gJXsQMNnrUZseJ0HuNMnxCuAdZzsSGTB0o9IHO+ifFGG1bJBUHExOEO8h6vLuKBdXoUZnwFEy5Bgvv4NNBNjPhkek7LuMd0t1oTu3oqCjpF7JvwgfZJ0EZBQNqS4QW506ivn3DPH6QtRLpsL4Id5pbFLwOBqWYkdQKTE6Qf4Qc15flf8I46PUO5b+evz045DLgogJZTluFWi0otUcqNprnsOz0NjYrpUNldiL8Beg/0uQsnicSAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/5e027d675a2616f4b4caa47be494817f/a59e9/image-23.webp 192w,\n/static/5e027d675a2616f4b4caa47be494817f/0ca9f/image-23.webp 384w,\n/static/5e027d675a2616f4b4caa47be494817f/dc9b9/image-23.webp 768w,\n/static/5e027d675a2616f4b4caa47be494817f/e2c2f/image-23.webp 1152w,\n/static/5e027d675a2616f4b4caa47be494817f/13a37/image-23.webp 1239w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/5e027d675a2616f4b4caa47be494817f/3b721/image-23.png 192w,\n/static/5e027d675a2616f4b4caa47be494817f/66595/image-23.png 384w,\n/static/5e027d675a2616f4b4caa47be494817f/fe486/image-23.png 768w,\n/static/5e027d675a2616f4b4caa47be494817f/d2d74/image-23.png 1152w,\n/static/5e027d675a2616f4b4caa47be494817f/85779/image-23.png 1239w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/5e027d675a2616f4b4caa47be494817f/fe486/image-23.png\"\n            alt=\"Alt text\"\n            title=\"Alt text\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span><br>\ndocker desktop 화면에서 정상 실행되고 있는 모습을 볼 수 있다. ES와 Kibana도 확인해보기로 하였다.<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 496px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c837ffc1ad4b0d7bb4790b17905494cc/60009/image-24.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACoklEQVQ4y21T2W7aQBT1c1vjLQSSQMJSNi/YYJsYGxsbSkMBJVG3SFFVVX3p/3/Bqc60jkiUh+O5M3Pn3HMXS3n+AXGcIZqnSJIl1pst3PEE5sCEbzmYmg4ix4VL23LgWQ6c8QR+MIPvh8K2HQ+9/hDd9wNI86TANIhxHSXwwxRZvsHYchCYDoadIbzBCJFpwx6MkDkTzE0X3jTAIs0RzlK4Ex8j00Gr3UWj2YL0+H2Dh68HhNdL/Pm1w36/w2pzwHab4+fjFsWHPW52tyhWn7DbrfD4cINitUOaLvD7x0cU6xvsD3e42R5we/sZ0n6bYLNOMfZCfLnLhOMsSlEsY9wfMiSLAllWYB4vsc5j3O0zXEcZoijCt/sc8zjFMl8hWSxF6SRNr0LTDei6BrmiQTcMqKoKWVbw5m0FlUoFsixDVRUoigZZVqFphI53wtagKKp4Q0j1eh1hGKDb7cK2LTiOg1qtjlarhXa7hcvLS3Q6bdRqNei6DsPQBQnBfbmWkE5PT2HbNsbjsVhJcHZ2Btd14XkegiCA7/vifjQa4eLiQig5JnlGaBiGeLhYLARZo9EQ6ggGq1arwvHk5ETY9H9JcqxWYrReryfUUQFBUioyTVOQsoaKojzVk6D9WuqCcDgcYjKZII5jtNttkVaWZSLd6XQqglmWJXySJMFsNhMlYUCeU8AzQqpi2hwFKiNpWQY2qd/viyzoRzISc0/1xHEZBGGn0xFOZXPoTJVlE/jA+D9OTJ215PpvnNSn1J9qSAVUF4ahIGaqTL+sI1eeMRDTY9d5znccp+OuSxwRdrTZbIrIXMtun5+f4+rqSqCcwxL05RmVH8+imEOSkICXHHTumSoflAHKh8co033WZX5Yj/KyrFP5K9EmXv4Rr80hCf8CFknDTVbLwa8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c837ffc1ad4b0d7bb4790b17905494cc/a59e9/image-24.webp 192w,\n/static/c837ffc1ad4b0d7bb4790b17905494cc/0ca9f/image-24.webp 384w,\n/static/c837ffc1ad4b0d7bb4790b17905494cc/8d866/image-24.webp 496w\"\n              sizes=\"(max-width: 496px) 100vw, 496px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c837ffc1ad4b0d7bb4790b17905494cc/3b721/image-24.png 192w,\n/static/c837ffc1ad4b0d7bb4790b17905494cc/66595/image-24.png 384w,\n/static/c837ffc1ad4b0d7bb4790b17905494cc/60009/image-24.png 496w\"\n            sizes=\"(max-width: 496px) 100vw, 496px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c837ffc1ad4b0d7bb4790b17905494cc/60009/image-24.png\"\n            alt=\"Alt text\"\n            title=\"Alt text\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span><br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/960299cae5a0fece0540e774bd4d88dd/adc5a/image-25.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABwklEQVQoz5WSW27TQBSGvY8mTgqNEoEEYk+8oLZKYjsVSDywANaBxB6QeKUgUEQVWmK3TVJaJaHQAonnZvtDtsmlVaQWS0cz/s/MN/85M1atdp8HDx9Rrd1jo1KlUqmyvr7BWqGEbZcpFMsU7TzWCmWKxdJibi/CLt2laN/Bcpp1XNfDcRxct0HLa9B0PLa2m+y06tQbHq6T6g5PNps0G9u0Wh6bW/VsbZrzXIenz1/g7jzD+jNVCGlQOkKqRcz+l/VsvqRHBpSO87zUSGWwJqHKBG3i/wplEoYXQ4Scok0y163fE8k0zF2mJ6Qn3xTpRhNB/9c5oRREMfNcBpyEer5wNl5xcw121BvgB0f0e98IDnsEh8eEQucO05Kvw1ZBZ3r6aRMhhETItF0aKRVxQg4UylxxsQo4y5kopn9yxuB0zOj7JcPxxTzORj8RUmMtQ5ahq4BRlNDuBHz47NPpDuh87dPp9rNx3x8QCoV1m1L13GFC98Dny94+7b2A3bbP+7bPu09dgsE4L/lG2JLDJI55+faUx68Ddo8vSR/iVKisl0qbrLfWrd5cBowxJuLNwQ9efRzRO58QGf3vYlKozC7oLxi+UC560SmQAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/960299cae5a0fece0540e774bd4d88dd/a59e9/image-25.webp 192w,\n/static/960299cae5a0fece0540e774bd4d88dd/0ca9f/image-25.webp 384w,\n/static/960299cae5a0fece0540e774bd4d88dd/dc9b9/image-25.webp 768w,\n/static/960299cae5a0fece0540e774bd4d88dd/a22c7/image-25.webp 1068w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/960299cae5a0fece0540e774bd4d88dd/3b721/image-25.png 192w,\n/static/960299cae5a0fece0540e774bd4d88dd/66595/image-25.png 384w,\n/static/960299cae5a0fece0540e774bd4d88dd/fe486/image-25.png 768w,\n/static/960299cae5a0fece0540e774bd4d88dd/adc5a/image-25.png 1068w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/960299cae5a0fece0540e774bd4d88dd/fe486/image-25.png\"\n            alt=\"Alt text\"\n            title=\"Alt text\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span><br>\n둘다 정상접속이 된다.</p>\n<h1 id=\"postgresql--logstash\" style=\"position:relative;\">PostgreSQL &#x26; Logstash<a href=\"#postgresql--logstash\" aria-label=\"postgresql  logstash permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p><code class=\"language-text\">데이터 포털 내의 PostgreSQL DB</code>와 연결하기 위해 logstash 폴더내의 conf 파일을 다음과 같이 설정해줬다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Sample Logstash configuration for creating a simple</span>\n<span class=\"token comment\"># Beats -> Logstash -> Elasticsearch pipeline.</span>\n\ninput <span class=\"token punctuation\">{</span>\n  jdbc <span class=\"token punctuation\">{</span> \n    jdbc_driver_library <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"./jar/postgresql-42.6.0.jar\"</span>\n    jdbc_driver_class <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"org.postgresql.Driver\"</span>\n    jdbc_connection_string <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"jdbc:postgresql://<span class=\"token variable\">${POSTGRES_HOST}</span>:<span class=\"token variable\">${POSTGRES_PORT}</span>/<span class=\"token variable\">${POSTGRES_DB}</span>\"</span>\n    jdbc_user <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"<span class=\"token variable\">${POSTGRES_USER}</span>\"</span>\n    jdbc_password <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"<span class=\"token variable\">${POSTGRES_PASSWORD}</span>\"</span>\n    schedule <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"* * * * *\"</span>\n    statement <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"select * from tb_table_meta_info\"</span>\n\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\noutput <span class=\"token punctuation\">{</span>\n    stdout <span class=\"token punctuation\">{</span> codec <span class=\"token operator\">=</span><span class=\"token operator\">></span> json_lines <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre></div>\n<p>실행 후, Docker log 상에 1분마다 데이터를 SELECT 해와야 하는 내용이 적혀있어야 하지만, 다음과 같은 오류가 발생하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Error: unable to load ./jar/postgresql-42.6.0.jar from :jdbc_driver_library, <span class=\"token function\">file</span> not readable <span class=\"token punctuation\">(</span>please check user and group permissions <span class=\"token keyword\">for</span> the path<span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">PluginLoadingError</code> 라고 한다. 한 번 해결해보자.</p>\n<h2 id=\"trouble-shooting-1---exception-logstash-pluginloadingerror\" style=\"position:relative;\">Trouble Shooting #1 - Exception: LogStash: PluginLoadingError<a href=\"#trouble-shooting-1---exception-logstash-pluginloadingerror\" aria-label=\"trouble shooting 1   exception logstash pluginloadingerror permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<blockquote>\n<p>참고글 : <a href=\"https://dnai-deny.tistory.com/73\" target=\"_blank\" rel=\"nofollow\">Logstash를 통해 PostgreSQL과 Elastic Stack 연동하기</a></p>\n</blockquote>\n<p>jdbc_driver_library에 다운로드한 JDBC Driver의 <code class=\"language-text\">절대 경로</code> 값을 넣어줘야 한다고 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Sample Logstash configuration for creating a simple</span>\n<span class=\"token comment\"># Beats -> Logstash -> Elasticsearch pipeline.</span>\n\ninput <span class=\"token punctuation\">{</span>\n  jdbc <span class=\"token punctuation\">{</span> \n    jdbc_driver_library <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"/usr/share/logstash/postgresql-42.6.0.jar\"</span>\n    jdbc_driver_class <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"org.postgresql.Driver\"</span>\n    jdbc_connection_string <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"jdbc:postgresql://<span class=\"token variable\">${POSTGRES_HOST}</span>:<span class=\"token variable\">${POSTGRES_PORT}</span>/<span class=\"token variable\">${POSTGRES_DB}</span>\"</span>\n    jdbc_user <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"<span class=\"token variable\">${POSTGRES_USER}</span>\"</span>\n    jdbc_password <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"<span class=\"token variable\">${POSTGRES_PASSWORD}</span>\"</span>\n    schedule <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"* * * * *\"</span>\n    statement <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"select * from tb_table_meta_info\"</span>\n\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\noutput <span class=\"token punctuation\">{</span>\n    stdout <span class=\"token punctuation\">{</span> codec <span class=\"token operator\">=</span><span class=\"token operator\">></span> json_lines <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2 id=\"logstashconf-input-설정\" style=\"position:relative;\">logstash.conf input 설정<a href=\"#logstashconf-input-%EC%84%A4%EC%A0%95\" aria-label=\"logstashconf input 설정 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ul>\n<li>\n<p><code class=\"language-text\">jdbc_driver_library</code>: JDBC 드라이버 JAR 파일의 경로를 설정한다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">jdbc_connection_string</code>: PostgreSQL 데이터베이스에 연결하기 위한 정보를 설정한다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">jdbc_user</code> 및 <code class=\"language-text\">jdbc_password</code>: PostgreSQL 데이터베이스에 액세스하기 위한 사용자 이름 및 비밀번호를 설정한다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">jdbc_driver_class</code>: jdbc를 사용하는 만큼 어떤 jdbc module을 핵심적으로 사용할지 세팅하는 부분이다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">statement</code>: 가져올 데이터를 쿼리로 세팅한다. query based cdc의 가장 핵심적인 부분이 된다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">schedule</code>: query를 실행할 주기를 cron 형태로 세팅한다. 안되어 있으면 한 번 input이 일어난 뒤에 service kill 된다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">jdbc_paging_enabled</code> &#x26; <code class=\"language-text\">jdbc_page_size</code>: 위 설정값엔 없지만, select 등의 결과값을 한 번에 너무많이 가져올 경우 target db가 lock 걸릴 리스크가 있다. 특히 target db가 엔터프라이즈 db의 경우 CDC를 위한 query를 던질 때 마다 api가 timeout이 나는 기적을 경험할 수 있다.</p>\n<ul>\n<li>이를 위해 pagination 기능을 제공하며 size와 offset값을 활용해 세팅한 row값 만큼만 가져오게 세팅할 수 있으며, jdbc_paging_enabled가 true 여야 jdbc_page_size 를 세팅할 수 있다.</li>\n<li><a href=\"https://www.elastic.co/guide/en/logstash/current/plugins-inputs-jdbc.html#plugins-inputs-jdbc-jdbc_paging_enabled\" target=\"_blank\" rel=\"nofollow\">es jdbc official docs</a></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"추가적인-설정\" style=\"position:relative;\">추가적인 설정<a href=\"#%EC%B6%94%EA%B0%80%EC%A0%81%EC%9D%B8-%EC%84%A4%EC%A0%95\" aria-label=\"추가적인 설정 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">input <span class=\"token punctuation\">{</span>\n  jdbc <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\"># 추가적인 설정</span>\n    jdbc_paging_enabled <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"true\"</span>\n    jdbc_paging_mode <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"explicit\"</span>\n    jdbc_page_size <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"100000\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>schedule 마다 실행되는 것은 좋으나, 계속 query의 result를 모두 output으로 준다는 것이다. CDC를 위해서 <code class=\"language-text\">마지막으로 읽은 부분을 기억하고 해당 부분 부터 가져와야 한다</code> 것이 중요하다.</p>\n</li>\n<li>\n<p>가장 먼저 봤던 docker-compose.yml file에서 logstash의 volumes에 잡혀있던 /usr/share/logstash/inspector-index.dat 가 <code class=\"language-text\">마지막으로 읽은 row, line을 기록하는 file</code> 이다. fluented, promtail 등이 사용하는 컨셉이 같다!</p>\n</li>\n<li>\n<p>그래서 볼륨으로 잡아줄 <code class=\"language-text\">./logstash/inspector-index.dat</code>파일을 아래와 같이 구성하고, <code class=\"language-text\">logstash.conf</code>에 설정값을 추가해주기로 하였다.</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># bat 설치</span>\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> bat <span class=\"token comment\"># 우분투</span>\n$ <span class=\"token function\">ln</span> -s /usr/bin/batcat ~/.local/bin/bat <span class=\"token comment\"># batcat을 bat으로 바꿔주는 명령어. 이걸 안해주면 batcat으로 사용해야한다.</span>\n\n<span class=\"token comment\"># logstash 폴더로 간 후, </span>\n$ bat inspector-index.dat</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 656px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d0d16b7c1ff80a0b89c27636e31eeed5/5ad6b/image-27.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.229166666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAApUlEQVQY05XOS26DMBSFYTZB7WvHxqjYGIQJIU2EInX/y/qrhD6UWTr4BufqHOlWzW1GPif0NqLWiJxG5P2MdCs2nrHpgk1XbFyx6QPbLXvuN1zeGKcjOfcMw0AphSr1Cec9zjlCCHjvCaGlaQLGGEQEEfNNdsbunm7y6Ff30MVIzgPLciLnzDwfKVPBHQ6I6L/RC6qfL9q2Rak36rr+pZRCa/0vXwIHbFcFvCigAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/d0d16b7c1ff80a0b89c27636e31eeed5/a59e9/image-27.webp 192w,\n/static/d0d16b7c1ff80a0b89c27636e31eeed5/0ca9f/image-27.webp 384w,\n/static/d0d16b7c1ff80a0b89c27636e31eeed5/0ccf2/image-27.webp 656w\"\n              sizes=\"(max-width: 656px) 100vw, 656px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/d0d16b7c1ff80a0b89c27636e31eeed5/3b721/image-27.png 192w,\n/static/d0d16b7c1ff80a0b89c27636e31eeed5/66595/image-27.png 384w,\n/static/d0d16b7c1ff80a0b89c27636e31eeed5/5ad6b/image-27.png 656w\"\n            sizes=\"(max-width: 656px) 100vw, 656px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/d0d16b7c1ff80a0b89c27636e31eeed5/5ad6b/image-27.png\"\n            alt=\"Alt text\"\n            title=\"Alt text\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span><br>\nbat 을 사용하여 inspectore-index.dat 파일 구성 완료 후, logstash를 실행하면 — 뒤의 0 값이 다음과 같이 3018, 즉 가장 마지막으로 읽은 id 값으로 변경될 것 이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">input <span class=\"token punctuation\">{</span>\n    jdbc <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\"># 마지막에 실행된 row의 값을 저장할 수 있는 설정</span>\n    use_column_value <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"true\"</span>\n    tracking_column <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"table_meta_info_id\"</span>\n    last_run_metadata_path <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"/usr/share/logstash/inspector-index.dat\"</span>\n    statement <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"select * from tb_table_meta_info where table_meta_info_id > :sql_last_value order by table_meta_info_id asc\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p><code class=\"language-text\">use_column_value</code>: 해당 값이 true여야 statement에 sql_last_value 변수를 사용할 수 있으며, file로 저장되는 id 값 metadata를 저장하고 가져올 수 있다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">tracking_column</code>: 마지막에 읽은 값 기준을 잡아줄 컬럼 명을 설정하는 값이다. 기본적으로 auto increment 세팅이 되어있는 값을 pk로 잡으니, 해당 값을 기준으로 잡으면 좋다. 그리고 값은 numeric 또는 timestamp 를 가지며 기본값은 numeric 이다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">last_run_metadata_path</code>: 마지막에 읽은 값을 저장할 file path를 세팅한다. 위 compose yaml에서 세팅한 볼륨 경로로 맞춰주면 된다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">statement</code> 값 역시 위 설정에 맞춰서 바뀌었다. 그리고 “마지막에 읽은 값” 이기 때문에 select order by를 꼭 “ASC” 로 세팅해야한다.</p>\n</li>\n</ul>\n<p>이제 다시 실행해보면 inspector-index.dat 이 업데이트 되면서 매 분 query가 실행될 때 마다 같은 결과 값이 아닌 추가된 값만 출력되는 것을 볼 수 있다.<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f56764586647ba08adec5c03c30765a3/b00dd/image-26.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.083333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABCUlEQVQY0z2Q207DMBBE8wJ14sTOpUns3EOKqoJUlaK2oioCif//poPsCh5W411pzu44eL9+czjfmDY7itJg2pFhfsZ2E6XpaMeF0rSoNEcm2tffO9EZSufEib6X0gQvbxdejxe6caG2PaYbqWzvgeu6Ic1Lb5SJQoQRIpSEMmYlQiKZICKJEBFhFBNGksBdePr8YVq21M1AMzxh2oGmn7HdSFqU5OuaojIUlfVLvFb2f+aWZkWFjBXB/nTj+PHFuGyx/ewjOqDtJw93gLrpyYrSw51RZ4XvdZqjs7VPEKuUlRAEu8OZ/elKP28w3R3ioju4u9IBS9OQqNSbnPr/86r8zEV39fC44hcVIX9CI67CpwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f56764586647ba08adec5c03c30765a3/a59e9/image-26.webp 192w,\n/static/f56764586647ba08adec5c03c30765a3/0ca9f/image-26.webp 384w,\n/static/f56764586647ba08adec5c03c30765a3/dc9b9/image-26.webp 768w,\n/static/f56764586647ba08adec5c03c30765a3/e2c2f/image-26.webp 1152w,\n/static/f56764586647ba08adec5c03c30765a3/4c2fa/image-26.webp 1227w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f56764586647ba08adec5c03c30765a3/3b721/image-26.png 192w,\n/static/f56764586647ba08adec5c03c30765a3/66595/image-26.png 384w,\n/static/f56764586647ba08adec5c03c30765a3/fe486/image-26.png 768w,\n/static/f56764586647ba08adec5c03c30765a3/d2d74/image-26.png 1152w,\n/static/f56764586647ba08adec5c03c30765a3/b00dd/image-26.png 1227w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f56764586647ba08adec5c03c30765a3/fe486/image-26.png\"\n            alt=\"Alt text\"\n            title=\"Alt text\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h1 id=\"참고링크\" style=\"position:relative;\">참고링크<a href=\"#%EC%B0%B8%EA%B3%A0%EB%A7%81%ED%81%AC\" aria-label=\"참고링크 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<ul>\n<li><a href=\"https://velog.io/@qlgks1/Elasticsearch-ELK-stack-Postgresql-Logstash-query-based-CDC-%EB%A7%8C%EB%93%A4%EA%B8%B0-by-docker-compose\" target=\"_blank\" rel=\"nofollow\">Elasticsearch - ELK stack &#x26; PostgreSQL &#x26; Logtash, query based CDC 만들기 by docker compose</a></li>\n</ul>","frontmatter":{"title":"CDC with ELK Stack","summary":"CDC 환경 학습을 위한 ELK Stack 활용법","date":"2023.11.01.","categories":["VISANG","CDC","ElasticSearch","Logstash","Kibana"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABtElEQVQoz4WS0UsUURTG5y/pPaRC36IgDH0oJOjBHqJgwRfDJ/XRP6LopUBIQUJLi4JEdBHcXUEHZaG2hyBWmNlt3W13yZmNmW1m7v3F3juru7rqgZlzz3cO937fOccAkFKivUCfVHSMt2s6wi7rrDNUoUaVj0KPwCsg4prILyGEzrX+UkiCqkPw2yE6POogo73R9YJo4H2fhv0BpP1SXfLPvE34Y/KETcPHS8xxdP85jaVdjYkTNYqhEJEKlhdmGX94iyeLH9gsFICQX2vXqGz04fouIeA1/vLi5lP2Jl/HjekhORJCBUtfVrnzbIK7n/aZtxyFJUaHudF/hcHVRd4U8wR/HK6ODHH93Ss264damJS9JTtSMJUzSeyt87n4U2GprW0ePHrMvbX3LBTzyGaTsY9vGd1JMvN198xgjNNNbVvkN6nX68dxe/5+06fVoJaqQIiLh9KiHsbyv+Vy5OKvUqlgWRalUolsNkvBss9fmy6woxfVapVkMolpmmQyGZZXVsgfHJBOp9lKpTSB8xh2L69OuK5LuVxWF9u2Ta1WU2fHcVROxEpOt8q4bPMvsl51/wHdoTS9bq3CzgAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/550453d38d1c75694a0ab3984eb8d9a1/ccf95/thumbnail-elk.png","srcSet":"/static/550453d38d1c75694a0ab3984eb8d9a1/ba754/thumbnail-elk.png 483w,\n/static/550453d38d1c75694a0ab3984eb8d9a1/b4d90/thumbnail-elk.png 966w,\n/static/550453d38d1c75694a0ab3984eb8d9a1/ccf95/thumbnail-elk.png 1932w","sizes":"(min-width: 1932px) 1932px, 100vw"},"sources":[{"srcSet":"/static/550453d38d1c75694a0ab3984eb8d9a1/da43d/thumbnail-elk.webp 483w,\n/static/550453d38d1c75694a0ab3984eb8d9a1/026bc/thumbnail-elk.webp 966w,\n/static/550453d38d1c75694a0ab3984eb8d9a1/99b19/thumbnail-elk.webp 1932w","type":"image/webp","sizes":"(min-width: 1932px) 1932px, 100vw"}]},"width":1932,"height":1108}},"publicURL":"/static/550453d38d1c75694a0ab3984eb8d9a1/thumbnail-elk.png"}}}}]}},"pageContext":{"slug":"/CDC_with_ES/"}},"staticQueryHashes":[]}
{"componentChunkName":"component---src-templates-post-template-tsx","path":"/오픈소스 6기 멘토링_Elasticsearch 기여/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EC%A7%80%EB%82%9C-%EC%98%A4%ED%94%88%EC%86%8C%EC%8A%A4-%EA%B8%B0%EC%97%AC\">지난 오픈소스 기여</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%9D%B4%EC%8A%88-%EC%84%A0%EC%A0%95\">이슈 선정</a></p>\n<ul>\n<li><a href=\"#1-kibana%EC%97%90-constant_keyword-%ED%83%80%EC%9E%85-%EA%B0%92%EC%9D%B4-%ED%95%98%EC%9D%B4%EB%9D%BC%EC%9D%B4%ED%8C%85-%EC%95%88%EB%90%98%EB%8A%94-%EC%98%A4%EB%A5%98-%EC%88%98%EC%A0%95\">1. Kibana에 constant_keyword 타입 값이 하이라이팅 안되는 오류 수정</a></li>\n<li><a href=\"#2-runtime-field%EC%97%90-range-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%83%80%EC%9E%85-%EC%A7%80%EC%9B%90%ED%95%98%EB%8F%84%EB%A1%9D-%EC%88%98%EC%A0%95\">2. runtime field에 range 데이터 타입 지원하도록 수정</a></li>\n<li><a href=\"#%EC%B5%9C%EC%A2%85-%EC%9D%B4%EC%8A%88-%EC%84%A0%EC%A0%95\">최종 이슈 선정</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%BD%94%EB%93%9C-%EB%B6%84%EC%84%9D\">코드 분석</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%8A%90%EB%82%80%EC%A0%90\">느낀점</a></p>\n</li>\n</ul>","html":"<h1 id=\"지난-오픈소스-기여\" style=\"position:relative;\">지난 오픈소스 기여<a href=\"#%EC%A7%80%EB%82%9C-%EC%98%A4%ED%94%88%EC%86%8C%EC%8A%A4-%EA%B8%B0%EC%97%AC\" aria-label=\"지난 오픈소스 기여 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>2024년 3월달엔 elasticsearch 의 자바 클라이언트인 <code class=\"language-text\">elasticsearch-java</code> 에 기여하였지만, 코드 수정 사항을 제안하는 방식으로 성공하였다. 관리인을 제외한 외부인들은 직접 코드를 수정할 수 있는 권한이 없기 때문이다.<br>\n이번엔 공식 <code class=\"language-text\">elasticsearch</code> 저장소에, 그것도 직접 코드를 수정한 PR이 머지되는 모습을 보고 싶었기 떄문에 다시 한번 오픈소스 스터디에 참여하였다.</p>\n<h1 id=\"이슈-선정\" style=\"position:relative;\">이슈 선정<a href=\"#%EC%9D%B4%EC%8A%88-%EC%84%A0%EC%A0%95\" aria-label=\"이슈 선정 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>오픈소스 기여는 좋은 이슈 선정이 90% 이상이기 때문에, 이번에도 역시 이슈 선정하는데 가장 많은 시간을 투자하였다.</p>\n<h2 id=\"1-kibana에-constant_keyword-타입-값이-하이라이팅-안되는-오류-수정\" style=\"position:relative;\">1. Kibana에 constant_keyword 타입 값이 하이라이팅 안되는 오류 수정<a href=\"#1-kibana%EC%97%90-constant_keyword-%ED%83%80%EC%9E%85-%EA%B0%92%EC%9D%B4-%ED%95%98%EC%9D%B4%EB%9D%BC%EC%9D%B4%ED%8C%85-%EC%95%88%EB%90%98%EB%8A%94-%EC%98%A4%EB%A5%98-%EC%88%98%EC%A0%95\" aria-label=\"1 kibana에 constant_keyword 타입 값이 하이라이팅 안되는 오류 수정 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><a href=\"https://github.com/elastic/elasticsearch/issues/85596\" target=\"_blank\" rel=\"nofollow\">Highlighting in Kibana doesn’t work for constant_keyword field type</a></p>\n<p>이미 완성된 PR이 있으며, 관리자분들께서 너무 복잡하다고 피드백을 해주셔서, 해당 PR을 참고하여 좀 더 간결하게 수정하면 새로운 PR을 금방 만들 수 있을 것 같아 선정하였다. 하지만, PR 분석 결과 커밋 사항이 과도하게 많아서 어떤 커밋사항들을 참고해야할지 결정하는데 시간이 오래 걸릴 것 같았다.</p>\n<h2 id=\"2-runtime-field에-range-데이터-타입-지원하도록-수정\" style=\"position:relative;\">2. runtime field에 range 데이터 타입 지원하도록 수정<a href=\"#2-runtime-field%EC%97%90-range-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%83%80%EC%9E%85-%EC%A7%80%EC%9B%90%ED%95%98%EB%8F%84%EB%A1%9D-%EC%88%98%EC%A0%95\" aria-label=\"2 runtime field에 range 데이터 타입 지원하도록 수정 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><a href=\"https://github.com/elastic/elasticsearch/issues/89707\" target=\"_blank\" rel=\"nofollow\">Expand runtime_field data types to include ranges</a></p>\n<p>참고할 수 있는 테스트 코드가 게시된 PR이 있기도 하며, 해당 PR은 현재 닫혀있는 상태라 활용하기 좋아보여 선택하였다. 하지만, 테스트 코드 작성법에 대한 커밋 사항은 보이지 않아 추가 분석이 필요하였다.</p>\n<h2 id=\"최종-이슈-선정\" style=\"position:relative;\">최종 이슈 선정<a href=\"#%EC%B5%9C%EC%A2%85-%EC%9D%B4%EC%8A%88-%EC%84%A0%EC%A0%95\" aria-label=\"최종 이슈 선정 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>하이리이팅은 es 팀내에서 아직 중요도가 높은 이슈가 아니라고 이슈 댓글에 명시되어 있었다. 그리고, 검색 쿼리에서 날짜의 범위 지정 옵션이 없는 건 매우 불편한 사항이기에, 2번째 이슈를 선택하였다.</p>\n<h1 id=\"코드-분석\" style=\"position:relative;\">코드 분석<a href=\"#%EC%BD%94%EB%93%9C-%EB%B6%84%EC%84%9D\" aria-label=\"코드 분석 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>이미 게시된 PR을 살펴보니, 날짜 runtime field에 대한 테스트 코드를 볼 수 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">// Test Code\r\n// modules/runtime<span class=\"token punctuation\">-</span>fields<span class=\"token punctuation\">-</span>common/src/yamlRestTest/resources/rest<span class=\"token punctuation\">-</span>api<span class=\"token punctuation\">-</span>spec/test/runtime_fields/43_date_calculated_at_index.yml\r\n\r\n <span class=\"token key atrule\">mappings</span><span class=\"token punctuation\">:</span>\r\n            <span class=\"token key atrule\">properties</span><span class=\"token punctuation\">:</span>\r\n              <span class=\"token key atrule\">range</span><span class=\"token punctuation\">:</span>\r\n                <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> date\r\n                <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\r\n                  <span class=\"token key atrule\">source</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\r\n                    for (def dt : doc['timestamp']){\r\n                      emit(dt.plus(params.days,ChronoUnit.DAYS).toEpochMilli());\r\n                      # range field\r\n                      if(params.days > 1){\r\n                         emit(dt.plus(params.days-1,ChronoUnit.DAYS).toEpochMilli());\r\n                      }\r\n                    }</span>\r\n                    \r\n   <span class=\"token key atrule\">search</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token key atrule\">index</span><span class=\"token punctuation\">:</span> sensor\r\n        <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">query</span><span class=\"token punctuation\">:</span>\r\n            <span class=\"token key atrule\">range</span><span class=\"token punctuation\">:</span>\r\n              <span class=\"token key atrule\">gte</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{start_date}}\"</span>\r\n              <span class=\"token key atrule\">lte</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">\"{{end_date}}\"</span>\r\n          <span class=\"token key atrule\">sort</span><span class=\"token punctuation\">:</span> timestamp\r\n          <span class=\"token key atrule\">fields</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>tomorrow<span class=\"token punctuation\">,</span> tomorrow_from_source<span class=\"token punctuation\">,</span> the_past<span class=\"token punctuation\">,</span> all_week<span class=\"token punctuation\">,</span> formatted_tomorrow<span class=\"token punctuation\">]</span>\r\n          <span class=\"token key atrule\">fields</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>tomorrow<span class=\"token punctuation\">,</span> tomorrow_from_source<span class=\"token punctuation\">,</span> the_past<span class=\"token punctuation\">,</span> all_week<span class=\"token punctuation\">,</span> formatted_tomorrow<span class=\"token punctuation\">,</span> range<span class=\"token punctuation\">]</span>\r\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">match</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token key atrule\">hits.total.value</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6</span><span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">match</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token key atrule\">hits.hits.0.fields.tomorrow</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"2018-01-19T17:41:34.000Z\"</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">match</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token key atrule\">hits.hits.0.fields.tomorrow_from_source</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"2018-01-19T17:41:34.000Z\"</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span>\r\n@@ <span class=\"token punctuation\">-</span><span class=\"token number\">124</span><span class=\"token punctuation\">,</span>6 +139<span class=\"token punctuation\">,</span><span class=\"token key atrule\">7 @@ setup</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token punctuation\">-</span> <span class=\"token datetime number\">2018-01-23T17:41:34.000Z</span>\r\n        <span class=\"token punctuation\">-</span> <span class=\"token datetime number\">2018-01-24T17:41:34.000Z</span>\r\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">match</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token key atrule\">hits.hits.0.fields.formatted_tomorrow</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token datetime number\">2018-01-19</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">match</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token key atrule\">hits.hits.0.fields.range</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1516729294000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1516642894000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1516556494000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1516470094000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1516383694000</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"2018-01-18T17:41:34.000Z\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token punctuation\">---</span>\r\n\"docvalue_fields\"<span class=\"token punctuation\">:</span></code></pre></div>\n<p>날짜 타입에 대해 <code class=\"language-text\">script</code>와 <code class=\"language-text\">format</code> 속성이 필요하다는 사실을 알게 되었다.</p>\n<p>runtime field 지정 클래스인 <code class=\"language-text\">RuntimeField</code> 클래스 내에서 필드 변수 타입에 따라 특정 코드가 시행되도록 지정할 수 있었으므로, 다음과 같이 클래스를 변경해줬다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// server/src/main/java/org/elasticsearch/index/mapper/RuntimeField.java</span>\r\n<span class=\"token comment\">// RuntimeField.java</span>\r\n\r\n<span class=\"token keyword\">static</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">RuntimeField</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">parseRuntimeFields</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> node<span class=\"token punctuation\">,</span>\r\n    <span class=\"token class-name\">MappingParserContext</span> parserContext<span class=\"token punctuation\">,</span>\r\n    <span class=\"token class-name\">Function</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">RuntimeField<span class=\"token punctuation\">.</span>Builder</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">RuntimeField</span><span class=\"token punctuation\">></span></span> builder<span class=\"token punctuation\">,</span>\r\n    <span class=\"token keyword\">boolean</span> supportsRemoval\r\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">RuntimeField</span><span class=\"token punctuation\">></span></span> runtimeFields <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Map<span class=\"token punctuation\">.</span>Entry</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> iterator <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span><span class=\"token function\">entrySet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>iterator<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token class-name\">Map<span class=\"token punctuation\">.</span>Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> entry <span class=\"token operator\">=</span> iterator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">String</span> fieldName <span class=\"token operator\">=</span> entry<span class=\"token punctuation\">.</span><span class=\"token function\">getKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>supportsRemoval<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                runtimeFields<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>fieldName<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MapperParsingException</span><span class=\"token punctuation\">(</span>\r\n                    <span class=\"token string\">\"Runtime field [\"</span> <span class=\"token operator\">+</span> fieldName <span class=\"token operator\">+</span> <span class=\"token string\">\"] was set to null but its removal is not supported in this context\"</span>\r\n                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unchecked\"</span><span class=\"token punctuation\">)</span>\r\n            <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> propNode <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">)</span> entry<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token class-name\">Object</span> typeNode <span class=\"token operator\">=</span> propNode<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"type\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token class-name\">String</span> type<span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>typeNode <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MapperParsingException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"No type specified for runtime field [\"</span> <span class=\"token operator\">+</span> fieldName <span class=\"token operator\">+</span> <span class=\"token string\">\"]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n                type <span class=\"token operator\">=</span> typeNode<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n\r\n            <span class=\"token comment\">// FIX: Handle script field parsing</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>propNode<span class=\"token punctuation\">.</span><span class=\"token function\">containsKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"script\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> scriptNode <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">)</span> propNode<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"script\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token class-name\">Script</span> script <span class=\"token operator\">=</span> <span class=\"token function\">parseScript</span><span class=\"token punctuation\">(</span>fieldName<span class=\"token punctuation\">,</span> parserContext<span class=\"token punctuation\">,</span> scriptNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                propNode<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"script\"</span><span class=\"token punctuation\">,</span> script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n\r\n            <span class=\"token comment\">// FIX: Handle format field for date types</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"date\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> propNode<span class=\"token punctuation\">.</span><span class=\"token function\">containsKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"format\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token class-name\">String</span> format <span class=\"token operator\">=</span> propNode<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"format\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token comment\">// Validate and store format as needed</span>\r\n                propNode<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"format\"</span><span class=\"token punctuation\">,</span> format<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n\r\n            <span class=\"token class-name\">Parser</span> typeParser <span class=\"token operator\">=</span> parserContext<span class=\"token punctuation\">.</span><span class=\"token function\">runtimeFieldParser</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>typeParser <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MapperParsingException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"No handler for type [\"</span> <span class=\"token operator\">+</span> type <span class=\"token operator\">+</span> <span class=\"token string\">\"] declared on runtime field [\"</span> <span class=\"token operator\">+</span> fieldName <span class=\"token operator\">+</span> <span class=\"token string\">\"]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n            runtimeFields<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>fieldName<span class=\"token punctuation\">,</span> builder<span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>typeParser<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>fieldName<span class=\"token punctuation\">,</span> propNode<span class=\"token punctuation\">,</span> parserContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            propNode<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"type\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token class-name\">MappingParser</span><span class=\"token punctuation\">.</span><span class=\"token function\">checkNoRemainingFields</span><span class=\"token punctuation\">(</span>fieldName<span class=\"token punctuation\">,</span> propNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            iterator<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MapperParsingException</span><span class=\"token punctuation\">(</span>\r\n                <span class=\"token string\">\"Expected map for runtime field [\"</span> <span class=\"token operator\">+</span> fieldName <span class=\"token operator\">+</span> <span class=\"token string\">\"] definition but got a \"</span> <span class=\"token operator\">+</span> entry<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">Collections</span><span class=\"token punctuation\">.</span><span class=\"token function\">unmodifiableMap</span><span class=\"token punctuation\">(</span>runtimeFields<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이미 존재하는 테스트코드, 그리고 새롭게 고친 RuntimeField 클래스를 푸쉬한 다음, PR 로 게시하였다.</p>\n<p><a href=\"https://github.com/elastic/elasticsearch/pull/113748\" target=\"_blank\" rel=\"nofollow\">Closes: Expand runtime_field data types to include ranges</a></p>\n<p>이슈 링크를 단 다음, 수정 사항에 대한 설명를 함께 첨부하였다. 이번엔 반드시 PR Merge 에 성공하고 싶다.</p>\n<h1 id=\"느낀점\" style=\"position:relative;\">느낀점<a href=\"#%EB%8A%90%EB%82%80%EC%A0%90\" aria-label=\"느낀점 permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>저번 오픈소스 기여때와는 다르게, 실제 존재하는 테스트 코드를 기반으로 역추적하여 커밋 사항을 완성할 수 있었다. 테스트 코드의 중요성을 다시 한 번 느낄 수 있었으며, PR 완성이 힘들다면 테스트 코드라도 게시함으로써 다른 오픈소스 기여자분들의 PR 완성을 돕는 방식도 좋을 것 같다는 생각을 하였다.</p>","frontmatter":{"title":"오픈소스 6기 멘토링 : Elasticsearch Contribute","summary":"elasticsearch 오픈소스에 기여하기까지의 과정 회고","date":"2024.09.29.","categories":["OpenSource","ElasticSearch"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxElEQVQ4y+2SzQrCMBCE+/4v5NGTh1K1aVNI2qYUFFIQsYsiic2f2ESp4M2LQgcCu2S/ZRg2cl8omuGfgu1T0/YNFlKZm7TOKaW01saYYRjc2E4XSSlf5AP2dbu/JovkeODrzRYhlGUZIaTve4RQ13Vt2+5GFUVRVRUAeAuR30SObJUvL6dzjnNKadM0jDEAKMuSEEIpTdM0juO6rjHGnPMABz9aGiucdd6zMUZr7Sd8IYQAAP/1ITAbXkhlGth8YX8P3wH9/Jzk9XL+hAAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/f35cb921e3af7624a8dfa4e64a52c178/6641e/thumbnail-gdg.png","srcSet":"/static/f35cb921e3af7624a8dfa4e64a52c178/f5f72/thumbnail-gdg.png 240w,\n/static/f35cb921e3af7624a8dfa4e64a52c178/fdfcd/thumbnail-gdg.png 480w,\n/static/f35cb921e3af7624a8dfa4e64a52c178/6641e/thumbnail-gdg.png 960w","sizes":"(min-width: 960px) 960px, 100vw"},"sources":[{"srcSet":"/static/f35cb921e3af7624a8dfa4e64a52c178/b5014/thumbnail-gdg.webp 240w,\n/static/f35cb921e3af7624a8dfa4e64a52c178/b47e6/thumbnail-gdg.webp 480w,\n/static/f35cb921e3af7624a8dfa4e64a52c178/d2939/thumbnail-gdg.webp 960w","type":"image/webp","sizes":"(min-width: 960px) 960px, 100vw"}]},"width":960,"height":960}},"publicURL":"/static/f35cb921e3af7624a8dfa4e64a52c178/thumbnail-gdg.png"}}}}]}},"pageContext":{"slug":"/오픈소스 6기 멘토링_Elasticsearch 기여/"}},"staticQueryHashes":[]}